# 🏹 **bandit_lib** — A pluggable contextual-bandit toolkit
*A tiny, opinionated scaffold that grows from notebook prototype ➜ production-grade micro-service.*

---

## 1&nbsp;·&nbsp;Why this repo exists
Most bandit tutorials stop at “import sklearn” examples.  
**bandit_lib** gives you a starter codebase that already knows how to:

* run repeatable **ETL** jobs,
* train classical or external-library bandit models,
* version and load models via a lightweight **registry**,
* expose real-time predictions behind a **FastAPI** endpoint,
* swap in back-ends like Vowpal Wabbit, MabWiser, TF-Agents, TorchRL, or your own learner with ~30 loc of adapter code.

---

## 2&nbsp;·&nbsp;Quick start (local, file-based)

```bash
git clone https://github.com/your-org/bandit_lib.git
cd bandit_lib
pip install -e .

# 1) Extract / transform sample data  ➜ ./datasets/
python -m bandit etl --config conf/etl.yaml --date 2025-07-16

# 2) Train LinUCB on the processed data ➜ ./artifacts/
python -m bandit train --config conf/train.yaml --run-id demo-run

# 3) Serve predictions (reloads latest model automatically)
python -m bandit serve --config conf/registry.yaml  # http://localhost:8000/predict
```

All paths above default to the **FS registry** (`./artifacts/`).  
Switch to Redis/S3 in `conf/registry.yaml` when you’re ready.

---

## 3&nbsp;·&nbsp;Directory guide

| Path | What lives here |
|------|-----------------|
| `core/` | Pure-python logic (algorithms, action helpers, abstract protocols) |
| `adapters/` | Glue to external libraries (VW, MabWiser, TF-Agents, …) |
| `etl/` | `transforms.py` + runnable shell scripts for data pipelines |
| `registry/` | Back-ends that save/load versioned model artifacts |
| `training/cli/` | Typer commands → `bandit etl / train / serve` |
| `serving/` | FastAPI app (startup hooks, `/predict`, `/refresh`) |
| `conf/` | Human-friendly **YAML** configs (override with `--config`) |
| `datasets/` | Local Parquet/TFRecord generated by ETL |
| `artifacts/` | File-based model versions (used by `registry/fs.py`) |
| `tests/` | Unit + integration tests (pytest + hypothesis) |

---

## 4&nbsp;·&nbsp;Config philosophy

* **YAML** > JSON for hand-edited files (comments, anchors, env vars).
* Global defaults live in `conf/`; job-specific overrides via `--config`.
* Every training run writes a `metadata.yaml` next to `model.bin` for traceability.

---

## 5&nbsp;·&nbsp;Adding a new learner in 4 steps

1. `pip install your-bandit-sdk`
2. `mkdir adapters/your_sdk`
3. Implement a class that fulfils `core.protocols.model.ContextualBanditModel`
   and register it in an entry-point table (`pyproject.toml`).
4. Reference it in `train.yaml` → `backend: your_sdk`

No other folder needs to change.

---

## 6&nbsp;·&nbsp;Shell helpers (optional)

| Script | Purpose |
|--------|---------|
| `etl/scripts/run_etl.sh` | Run ETL for a given date |
| `etl/scripts/train.sh` | Train model using `conf/train.yaml` |
| `etl/scripts/export_model.sh` | Copy latest artifact somewhere else |

Each script is a thin wrapper around the Typer CLI; feel free to delete them if you prefer Make, Invoke, or pure Python.

---

## 7&nbsp;·&nbsp;Roadmap

* [ ] Promote `core/actions.basic` helpers into a full `Action` dataclass  
* [ ] Offline policy-evaluation module (IPS, DR, SNIPS)  
* [ ] Model-based simulators for regret testing  
* [ ] CI template (GitHub Actions) with lint, type-check, tests

---

## 8&nbsp;·&nbsp;Acknowledgements
Inspired by Spotify’s **bandit-pylib**, Facebook ReAgent, and VW’s CB-ADF mode.

Happy hacking 🚀
